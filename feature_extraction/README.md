# Feature extraction scripts

Scripts used to parse packet capture files (pcap) into csv

Execute `./run.sh raw/demo-IOC` to see how a network flow is labeled by IOC.txt.
Execute `./run.sh raw/HTBot` to see how to extract features if no IOC.txt isprovided.

## Usage

```
$ ./run.sh TARGET
```

TARGET should be the directory in `./raw` directory, the script will automatically
look for packet captures, parse them, and store in `./out` directory.

The processed file will be named as `full_data.csv`

## Directory format and description
```
.
├── 0-combine.py            - Combines csv logs generated by zeek
├── 1-preprocess.sh         - Split files into multiple fractions for multi-processing
├── 2-statistic-tmux.sh     - Calculate statistic data, starts multiple `tmux` window and runs 
                              statistic.py for fractioned files
├── 3-mergeall.sh           - Merge calculated fractioned files into single files
├── 4-label.py              - Label files according to IOC.txt, this is useful when we need to tune
                              the model according to some in
├── csv                     - Output directory of extracted feature
├── raw                     - Output directory of raw packet capture
├── README.md               - This README file
├── run.sh                  - Easy-to-use wrapped script
└── statistic.py            - Script used by `2-statistic-tmux.sh`
```

## IOC.txt file format

Refer to `4-label.py` for parsing details.
Rules are separated by dashed lines (`------`)

For example, the IoCs show below

```
id.resp_h = '68.183.200.251'
id.resp_p = 443
----------------------------
id.resp_h = '127.0.0.1'
id.resp_p = 4723
```

will be represented as the following filter

```
(id.resp_h == '68.183.200.251' && id.resp_p == 443) ||
(id.resp_h == '127.0.0.1' && id.resp_p == 4723)
```
























